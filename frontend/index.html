<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üçΩÔ∏è Zomato Restaurant Rating Predictor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap");
      body {
        font-family: "Inter", sans-serif;
      }
      .gradient-bg {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }
      .card-shadow {
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      }
      .input-focus:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }
      .rating-stars {
        color: #fbbf24;
      }
      .confidence-high {
        color: #10b981;
      }
      .confidence-medium {
        color: #f59e0b;
      }
      .confidence-low {
        color: #ef4444;
      }
      .loading-spinner {
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }
      .slide-in {
        animation: slideIn 0.5s ease-out;
      }
      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>
  <body class="bg-gray-50">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
      <div class="container mx-auto px-6 py-8">
        <div class="text-center">
          <h1 class="text-4xl font-bold mb-2">üçΩÔ∏è Zomato Restaurant Rating Predictor</h1>
          <p class="text-xl opacity-90">AI-Powered Restaurant Rating Prediction using 90+ Advanced Features</p>
          <div class="mt-4 flex justify-center space-x-6 text-sm">
            <span><i class="fas fa-brain mr-2"></i>ML Pipeline</span>
            <span><i class="fas fa-map-marker-alt mr-2"></i>Geolocation Analysis</span>
            <span><i class="fas fa-comments mr-2"></i>NLP Processing</span>
            <span><i class="fas fa-chart-line mr-2"></i>Real-time Predictions</span>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8">
      <!-- API Status Bar -->
      <div id="statusBar" class="mb-6 p-4 rounded-lg border border-gray-200 bg-white card-shadow">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-3">
            <div id="statusIndicator" class="w-3 h-3 rounded-full bg-gray-400"></div>
            <span id="statusText" class="font-medium">Checking API status...</span>
          </div>
          <div class="text-sm text-gray-600">
            <span id="modelInfo">Loading model info...</span>
          </div>
        </div>
      </div>

      <div class="grid lg:grid-cols-2 gap-8">
        <!-- Input Form -->
        <div class="bg-white rounded-2xl card-shadow p-8">
          <h2 class="text-2xl font-bold text-gray-800 mb-6">
            <i class="fas fa-utensils mr-3 text-blue-600"></i>Restaurant Information
          </h2>

          <form id="predictionForm" class="space-y-6">
            <!-- Basic Info -->
            <div class="grid md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Restaurant Name *</label>
                <input
                  type="text"
                  id="name"
                  required
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                  placeholder="e.g., Cafe Coffee Day"
                />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Location *</label>
                <input
                  type="text"
                  id="location"
                  required
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                  placeholder="e.g., Koramangala"
                />
              </div>
            </div>

            <!-- Cuisines -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Cuisines *</label>
              <input
                type="text"
                id="cuisines"
                required
                class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                placeholder="e.g., North Indian, Chinese, Continental"
              />
              <p class="text-sm text-gray-500 mt-1">Separate multiple cuisines with commas</p>
            </div>

            <!-- Cost and Type -->
            <div class="grid md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Cost for Two (‚Çπ)</label>
                <input
                  type="number"
                  id="cost_for_two"
                  min="50"
                  max="10000"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                  placeholder="800"
                />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Restaurant Type</label>
                <select id="rest_type" class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus">
                  <option value="">Select type</option>
                  <option value="Casual Dining">Casual Dining</option>
                  <option value="Quick Bites">Quick Bites</option>
                  <option value="Fine Dining">Fine Dining</option>
                  <option value="Cafe">Cafe</option>
                  <option value="Food Court">Food Court</option>
                  <option value="Sweet Shop">Sweet Shop</option>
                  <option value="Bakery">Bakery</option>
                </select>
              </div>
            </div>

            <!-- Services -->
            <div class="grid md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Online Ordering</label>
                <select id="online_order" class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus">
                  <option value="Yes">Yes</option>
                  <option value="No">No</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Table Booking</label>
                <select id="book_table" class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus">
                  <option value="No">No</option>
                  <option value="Yes">Yes</option>
                </select>
              </div>
            </div>

            <!-- Additional Info -->
            <div class="border-t pt-6">
              <h3 class="text-lg font-semibold text-gray-800 mb-4">Additional Information (Optional)</h3>

              <div class="grid md:grid-cols-2 gap-4 mb-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Number of Votes</label>
                  <input
                    type="number"
                    id="votes"
                    min="0"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                    placeholder="100"
                  />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Area</label>
                  <input
                    type="text"
                    id="area"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                    placeholder="e.g., Koramangala"
                  />
                </div>
              </div>

              <div class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Address</label>
                  <textarea
                    id="address"
                    rows="2"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                    placeholder="Full restaurant address"
                  ></textarea>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Popular Dishes</label>
                  <input
                    type="text"
                    id="dish_liked"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                    placeholder="e.g., Biryani, Pizza, Pasta"
                  />
                </div>
              </div>
            </div>

            <!-- Submit Button -->
            <div class="pt-6">
              <button
                type="submit"
                id="predictBtn"
                class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-4 px-6 rounded-lg font-semibold text-lg hover:from-blue-700 hover:to-purple-700 transition duration-300 transform hover:scale-105"
              >
                <i class="fas fa-magic mr-2"></i>
                <span id="btnText">Predict Rating</span>
                <i id="loadingSpinner" class="fas fa-spinner loading-spinner ml-2 hidden"></i>
              </button>
            </div>
          </form>
        </div>

        <!-- Results Panel -->
        <div class="bg-white rounded-2xl card-shadow p-8">
          <h2 class="text-2xl font-bold text-gray-800 mb-6">
            <i class="fas fa-chart-line mr-3 text-green-600"></i>Prediction Results
          </h2>

          <!-- Placeholder State -->
          <div id="placeholderState" class="text-center py-12">
            <div class="text-6xl mb-4">üîÆ</div>
            <h3 class="text-xl font-semibold text-gray-600 mb-2">Ready to Predict!</h3>
            <p class="text-gray-500">
              Fill in the restaurant details and click "Predict Rating" to see the AI's prediction.
            </p>
          </div>

          <!-- Results Display -->
          <div id="resultsDisplay" class="hidden slide-in">
            <!-- Predicted Rating -->
            <div class="text-center mb-8 p-6 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl">
              <div class="text-sm font-medium text-gray-600 mb-2">Predicted Rating</div>
              <div class="flex items-center justify-center mb-2">
                <span id="predictedRating" class="text-5xl font-bold text-gray-800">4.2</span>
                <span class="text-2xl text-gray-500 ml-1">/5</span>
              </div>
              <div id="ratingStars" class="rating-stars text-2xl mb-2">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</div>
              <div id="ratingDescription" class="text-sm text-gray-600">Very Good Restaurant</div>
            </div>

            <!-- Confidence Score -->
            <div class="mb-6 p-4 bg-gray-50 rounded-lg">
              <div class="flex items-center justify-between mb-2">
                <span class="font-medium text-gray-700">Confidence Score</span>
                <span id="confidenceScore" class="font-bold confidence-high">95%</span>
              </div>
              <div class="w-full bg-gray-200 rounded-full h-2">
                <div
                  id="confidenceBar"
                  class="bg-green-500 h-2 rounded-full transition-all duration-500"
                  style="width: 95%"
                ></div>
              </div>
              <div id="confidenceDescription" class="text-sm text-gray-600 mt-2">High confidence prediction</div>
            </div>

            <!-- Model Info -->
            <div class="grid grid-cols-2 gap-4 mb-6">
              <div class="text-center p-3 bg-blue-50 rounded-lg">
                <div id="featuresUsed" class="text-2xl font-bold text-blue-600">87</div>
                <div class="text-sm text-gray-600">Features Used</div>
              </div>
              <div class="text-center p-3 bg-purple-50 rounded-lg">
                <div id="processingTime" class="text-2xl font-bold text-purple-600">0.8s</div>
                <div class="text-sm text-gray-600">Processing Time</div>
              </div>
            </div>

            <!-- Processing Pipeline -->
            <div class="mb-6">
              <h4 class="font-semibold text-gray-800 mb-3">Processing Pipeline</h4>
              <div class="space-y-2">
                <div class="flex items-center text-sm">
                  <i class="fas fa-check-circle text-green-500 mr-2"></i>
                  <span>Data cleaning & standardization</span>
                </div>
                <div class="flex items-center text-sm">
                  <i class="fas fa-check-circle text-green-500 mr-2"></i>
                  <span>Geolocation feature engineering</span>
                </div>
                <div class="flex items-center text-sm">
                  <i class="fas fa-check-circle text-green-500 mr-2"></i>
                  <span>NLP & sentiment analysis</span>
                </div>
                <div class="flex items-center text-sm">
                  <i class="fas fa-check-circle text-green-500 mr-2"></i>
                  <span>ML model prediction</span>
                </div>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex space-x-3">
              <button
                id="newPredictionBtn"
                class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-300"
              >
                <i class="fas fa-plus mr-2"></i>New Prediction
              </button>
              <button
                id="downloadBtn"
                class="flex-1 bg-gray-600 text-white py-2 px-4 rounded-lg hover:bg-gray-700 transition duration-300"
              >
                <i class="fas fa-download mr-2"></i>Download
              </button>
            </div>
          </div>

          <!-- Error Display -->
          <div id="errorDisplay" class="hidden text-center py-8">
            <div class="text-4xl mb-4">‚ö†Ô∏è</div>
            <h3 class="text-xl font-semibold text-red-600 mb-2">Prediction Failed</h3>
            <p id="errorMessage" class="text-gray-600 mb-4">Something went wrong with the prediction.</p>
            <button
              id="retryBtn"
              class="bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700 transition duration-300"
            >
              <i class="fas fa-redo mr-2"></i>Try Again
            </button>
          </div>
        </div>
      </div>

      <!-- Features Info Section -->
      <div class="mt-12 bg-white rounded-2xl card-shadow p-8">
        <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">
          <i class="fas fa-cogs mr-3 text-indigo-600"></i>Advanced ML Features
        </h2>

        <div class="grid md:grid-cols-3 gap-6">
          <div class="text-center p-6 bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl">
            <div class="text-3xl mb-3">üó∫Ô∏è</div>
            <h3 class="font-semibold text-gray-800 mb-2">Geolocation Intelligence</h3>
            <p class="text-sm text-gray-600">
              Location popularity, competition analysis, area pricing patterns, and neighborhood classification
            </p>
          </div>

          <div class="text-center p-6 bg-gradient-to-br from-green-50 to-green-100 rounded-xl">
            <div class="text-3xl mb-3">üß†</div>
            <h3 class="font-semibold text-gray-800 mb-2">NLP & Text Analysis</h3>
            <p class="text-sm text-gray-600">
              Restaurant name patterns, cuisine diversity, sentiment analysis, and text complexity metrics
            </p>
          </div>

          <div class="text-center p-6 bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl">
            <div class="text-3xl mb-3">‚ö°</div>
            <h3 class="font-semibold text-gray-800 mb-2">Business Intelligence</h3>
            <p class="text-sm text-gray-600">
              Service features, pricing strategy, competitive advantage, and customer engagement patterns
            </p>
          </div>
        </div>

        <div class="mt-8 text-center">
          <div class="inline-flex items-center space-x-6 text-sm text-gray-600">
            <span><strong>90+</strong> engineered features</span>
            <span><strong>Real-time</strong> processing</span>
            <span><strong>Production-grade</strong> ML pipeline</span>
            <span><strong>Confidence</strong> scoring</span>
          </div>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="mt-16 bg-gray-800 text-white py-8">
      <div class="container mx-auto px-6 text-center">
        <p class="mb-2">üçΩÔ∏è Zomato Restaurant Rating Predictor v1.0</p>
        <p class="text-sm text-gray-400">
          Built with advanced ML, feature engineering, and production-ready architecture
        </p>
      </div>
    </footer>

    <script>
      // Configuration
      const API_BASE_URL = "http://localhost:8000";

      // DOM Elements
      const form = document.getElementById("predictionForm");
      const predictBtn = document.getElementById("predictBtn");
      const btnText = document.getElementById("btnText");
      const loadingSpinner = document.getElementById("loadingSpinner");
      const placeholderState = document.getElementById("placeholderState");
      const resultsDisplay = document.getElementById("resultsDisplay");
      const errorDisplay = document.getElementById("errorDisplay");

      // Status elements
      const statusIndicator = document.getElementById("statusIndicator");
      const statusText = document.getElementById("statusText");
      const modelInfo = document.getElementById("modelInfo");

      // Initialize app
      document.addEventListener("DOMContentLoaded", function () {
        checkAPIStatus();
        setupEventListeners();
      });

      // Check API status
      async function checkAPIStatus() {
        try {
          const response = await axios.get(`${API_BASE_URL}/health`);
          const health = response.data;

          if (health.status === "healthy") {
            statusIndicator.className = "w-3 h-3 rounded-full bg-green-500";
            statusText.textContent = "API Online";
            modelInfo.textContent = `Model: ${health.model_info.name || "Loaded"} | Uptime: ${Math.floor(
              health.uptime_seconds / 3600
            )}h`;
          } else {
            statusIndicator.className = "w-3 h-3 rounded-full bg-yellow-500";
            statusText.textContent = "API Degraded";
            modelInfo.textContent = "Model not fully loaded";
          }
        } catch (error) {
          statusIndicator.className = "w-3 h-3 rounded-full bg-red-500";
          statusText.textContent = "API Offline";
          modelInfo.textContent = "Cannot connect to prediction service";
          console.error("API health check failed:", error);
        }
      }

      // Setup event listeners
      function setupEventListeners() {
        form.addEventListener("submit", handlePrediction);
        document.getElementById("newPredictionBtn").addEventListener("click", resetForm);
        document.getElementById("retryBtn").addEventListener("click", handlePrediction);
        document.getElementById("downloadBtn").addEventListener("click", downloadResults);
      }

      // Handle form submission
      async function handlePrediction(e) {
        e.preventDefault();

        // Show loading state
        setLoadingState(true);
        hideAllStates();

        try {
          // Collect form data
          const formData = {
            name: document.getElementById("name").value,
            location: document.getElementById("location").value,
            cuisines: document.getElementById("cuisines").value,
            cost_for_two: parseFloat(document.getElementById("cost_for_two").value) || null,
            rest_type: document.getElementById("rest_type").value || null,
            online_order: document.getElementById("online_order").value,
            book_table: document.getElementById("book_table").value,
            votes: parseInt(document.getElementById("votes").value) || 100,
            area: document.getElementById("area").value || document.getElementById("location").value,
            category: "Dine-out",
            address: document.getElementById("address").value || null,
            dish_liked: document.getElementById("dish_liked").value || null,
            reviews_list: "[]",
          };

          console.log("Sending prediction request:", formData);

          // Make prediction request
          const startTime = Date.now();
          const response = await axios.post(`${API_BASE_URL}/predict`, formData);
          const processingTime = (Date.now() - startTime) / 1000;

          console.log("Prediction response:", response.data);

          // Display results
          displayResults(response.data, processingTime);
        } catch (error) {
          console.error("Prediction error:", error);
          displayError(error);
        } finally {
          setLoadingState(false);
        }
      }

      // Display prediction results
      function displayResults(data, processingTime) {
        // Update predicted rating
        const rating = data.predicted_rating;
        document.getElementById("predictedRating").textContent = rating.toFixed(1);

        // Update star rating
        updateStarRating(rating);

        // Update rating description
        updateRatingDescription(rating);

        // Update confidence score
        if (data.confidence_score) {
          updateConfidenceScore(data.confidence_score);
        } else {
          // Hide confidence section if not available
          document.querySelector(".mb-6.p-4.bg-gray-50").style.display = "none";
        }

        // Update features used
        document.getElementById("featuresUsed").textContent = data.input_features_count || "90+";

        // Update processing time
        document.getElementById("processingTime").textContent = `${processingTime.toFixed(1)}s`;

        // Show results
        resultsDisplay.classList.remove("hidden");
      }

      // Update star rating display
      function updateStarRating(rating) {
        const stars = document.getElementById("ratingStars");
        const fullStars = Math.floor(rating);
        const hasHalfStar = rating % 1 >= 0.5;

        let starDisplay = "";
        for (let i = 0; i < 5; i++) {
          if (i < fullStars) {
            starDisplay += "‚òÖ";
          } else if (i === fullStars && hasHalfStar) {
            starDisplay += "‚òÜ";
          } else {
            starDisplay += "‚òÜ";
          }
        }
        stars.textContent = starDisplay;
      }

      // Update rating description
      function updateRatingDescription(rating) {
        const description = document.getElementById("ratingDescription");
        let text, color;

        if (rating >= 4.5) {
          text = "Excellent Restaurant";
          color = "text-green-600";
        } else if (rating >= 4.0) {
          text = "Very Good Restaurant";
          color = "text-blue-600";
        } else if (rating >= 3.5) {
          text = "Good Restaurant";
          color = "text-yellow-600";
        } else if (rating >= 3.0) {
          text = "Average Restaurant";
          color = "text-orange-600";
        } else {
          text = "Below Average Restaurant";
          color = "text-red-600";
        }

        description.textContent = text;
        description.className = `text-sm ${color}`;
      }

      // Update confidence score
      function updateConfidenceScore(confidence) {
        const percentage = Math.round(confidence * 100);
        document.getElementById("confidenceScore").textContent = `${percentage}%`;

        const bar = document.getElementById("confidenceBar");
        const description = document.getElementById("confidenceDescription");

        bar.style.width = `${percentage}%`;

        if (percentage >= 80) {
          bar.className = "bg-green-500 h-2 rounded-full transition-all duration-500";
          document.getElementById("confidenceScore").className = "font-bold confidence-high";
          description.textContent = "High confidence prediction";
        } else if (percentage >= 60) {
          bar.className = "bg-yellow-500 h-2 rounded-full transition-all duration-500";
          document.getElementById("confidenceScore").className = "font-bold confidence-medium";
          description.textContent = "Medium confidence prediction";
        } else {
          bar.className = "bg-red-500 h-2 rounded-full transition-all duration-500";
          document.getElementById("confidenceScore").className = "font-bold confidence-low";
          description.textContent = "Low confidence prediction";
        }
      }

      // Display error
      function displayError(error) {
        let message = "An unexpected error occurred. Please try again.";

        if (error.response) {
          message = error.response.data.detail || message;
        } else if (error.request) {
          message = "Cannot connect to the prediction service. Please check if the API is running.";
        }

        document.getElementById("errorMessage").textContent = message;
        errorDisplay.classList.remove("hidden");
      }

      // Set loading state
      function setLoadingState(loading) {
        if (loading) {
          predictBtn.disabled = true;
          btnText.textContent = "Processing...";
          loadingSpinner.classList.remove("hidden");
        } else {
          predictBtn.disabled = false;
          btnText.textContent = "Predict Rating";
          loadingSpinner.classList.add("hidden");
        }
      }

      // Hide all state displays
      function hideAllStates() {
        placeholderState.classList.add("hidden");
        resultsDisplay.classList.add("hidden");
        errorDisplay.classList.add("hidden");
      }

      // Reset form
      function resetForm() {
        form.reset();
        hideAllStates();
        placeholderState.classList.remove("hidden");
      }

      // Download results
      function downloadResults() {
        const results = {
          restaurant: {
            name: document.getElementById("name").value,
            location: document.getElementById("location").value,
            cuisines: document.getElementById("cuisines").value,
          },
          prediction: {
            rating: document.getElementById("predictedRating").textContent,
            confidence: document.getElementById("confidenceScore").textContent,
            features_used: document.getElementById("featuresUsed").textContent,
            processing_time: document.getElementById("processingTime").textContent,
            timestamp: new Date().toISOString(),
          },
        };

        const blob = new Blob([JSON.stringify(results, null, 2)], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `zomato_prediction_${Date.now()}.json`;
        a.click();
        URL.revokeObjectURL(url);
      }

      // Refresh API status every 30 seconds
      setInterval(checkAPIStatus, 30000);
    </script>
  </body>
</html>
